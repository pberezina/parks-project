---
title: "STAT6730 Project"
subtitle: "Exploring park access data from the Trust for Public Land"
author: "Polina Berezina, Shan Tang"
date: "12/10/2021"
output: 
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE, echo=FALSE, warning=FALSE}
options(htmltools.dir.version = FALSE) 
library(dplyr)
library(ggplot2)
library(tidyverse)
library(mice)
library(reshape2)
library(VIM)
library(purrr)
library(xaringan)
```
  
# Introduction
The Trust for Public Land (TPL) tracks green space availability across U.S. using the **ParkScore index** to measures how well cities are meeting their residentsâ€™ need for public parks based on: 
- **park access**: residents% walk to park within 10-min walking 
- **acreage**: median size, parkland% of city area
- **investment**: spending/resident
- **amenities**: basketball hoops, dig park, playground, restroom, etc.
- **equity** distribution of parks according to race and income (2021 only)

### Questions
- Yearly trends
- The relationship between some features and park rankings
- Affect of adjusting for equity in the newest ranking in 2021

---
# Map of cities according to their 2020 data
TODO? 


---
# Data cleaning
- Year as a factor
- Removed % and $ in the data frame, convert variables from string (%) to double (0-1)

#### Before

```{r cleaning1, warning = FALSE, message=FALSE, echo=FALSE}
raw <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-06-22/parks.csv')
raw$year <- as.factor(raw$year)
original.colnames <- colnames(raw) # save for the 2021 data used later
head(raw[,c(1:3,6,8,10)], 1)   ### show the changes that we made
```

#### After

```{r cleaning2, warning = FALSE, message=FALSE, echo=FALSE}
library(stringr)
raw$park_pct_city_data<- as.numeric(str_replace_all(raw$park_pct_city_data, "%", ""))
raw$pct_near_park_data<- as.numeric(str_replace_all(raw$pct_near_park_data, "%", ""))
raw$spend_per_resident_data<- as.numeric(gsub("\\$","",raw$spend_per_resident_data))
head(raw[,c(1:3,6,8,10)], 1)
```

---
## Handling missing data
TODO: fix axis labels too small.
TODO: include imputation output?

- More than 30% of data is missing in 6 out of 28 variables, including restroom, splashground and park benches counts. We omit these variables from analysis. 

.center[
```{r remove, warning = FALSE, message=FALSE, echo=FALSE, fig.width=6,fig.height=4}
aggr(raw[,12:28], cex.axis=0.5)
raw <- select(raw, -c(city_dup, park_benches, splashground_points, splashground_data, restroom_points, restroom_data))
```
]

- Assuming missing at random for others: impute using mice package with PMM Hot Deck method

```{r impute, warning = FALSE, message=FALSE, echo=FALSE}
raw2 <- select(raw, -c(city, rank)) # everything but city and rank - not useful in imputations
imp <- mice(raw2, method="pmm", donors=5, print=FALSE) 
# library(lattice)
# densityplot(imp)
df <- complete(imp, 1)
df <- mutate(df, city = raw$city, rank = raw$rank, .after=1) # append back city and rank vars
### df contains imputed, cleaned variables for 2012-2020
```

---
## Exploratory data analysis

TODO: fix titles - cut off. Axis labels too small. Use 2021 colnames as titles?
TODO: describe what we see? 

#### The distribution of variables
TODO: increase figure width so that titles are not cut off? 
TODO: rename varaibles? 

.center[
```{r explore1, warning = FALSE, message=FALSE, echo=FALSE, fig.width=10,fig.height=6}
#basic histogram
d <- melt(df)
ggplot(d,aes(x = value)) + 
    facet_wrap(~variable,scales = "free_x") + 
    geom_histogram() + # geom_boxplot()
  theme_classic() +
  theme(strip.text.x = element_text(size = 11), text = element_text(size = 9), axis.text.x = element_text(angle=90)) 
```
]

---
#### Variables over the years

TODO: fix titles - cut off. Axis labels too small. Use 2021 colnames as titles?
TODO: X axis (years) is cut off 
TODO: maybe color outliers or add any pop of color? 
TODO: why points e.g. basketball points increase? Answer it on another slide with dplyr or another plot. 

Increasing trend in the `Spending per resident` and `% of residents` within a 10 minute walk to park.

.center[
```{r explore2, warning = FALSE, message=FALSE, echo=FALSE, fig.width=10,fig.height=6}
# boxplots per year for every varaible
ggplot(d) + 
    facet_wrap(~variable, scales = "free_y") + 
    geom_boxplot(aes(y=value, x=year, group = year)) +
  theme_classic() +
  theme(strip.text.x = element_text(size = 11),text = element_text(size = 9), axis.text.x = element_text(angle=90)) 
```
]

---
## Park Point vs. Features 

TODO: add 1 sentence explnation of the figure implications 

.center[
```{r, warning = FALSE, message=FALSE, echo=FALSE, fig.width=10,fig.height=7}
library(ggpubr)

p1<-ggplot(df, aes(x=med_park_size_data, y=med_park_size_points, color=year))+ 
    geom_point(alpha=0.6)+
    labs(title="Size Score 1 VS. Median Park Size", x="Median Park Size (Acres)", y="Score")+
    theme_classic() +
    theme(text = element_text(size = 9))

p2<-ggplot(df, aes(x=park_pct_city_data, y=park_pct_city_points, color=year))+ 
    geom_point(alpha=0.6)+
    labs(title="Size Score 2 VS. % Park Size", x="Park Size (% city area) ", y="Score")+
    theme_classic() +
    theme(text = element_text(size = 9))

p3<-ggplot(df, aes(x=pct_near_park_data, y=pct_near_park_points, color=year))+ 
    geom_point(alpha=0.6)+
    labs(title="Access Score VS. Accessibility", x="Residents% within 10-min Walking", y="Score")+
    theme_classic() +
    theme(text = element_text(size = 9))

p4<-ggplot(df, aes(x=spend_per_resident_data, y=spend_per_resident_points, color=year))+ 
    geom_point(alpha=0.6)+
    labs(title="Cost Score VS. Investment", x="Cost per resident ($)", y="Score")+
    theme_classic() +
    theme(text = element_text(size = 9))

ggarrange(p1, p2, p3, p4,
          ncol = 2, nrow = 2,
          common.legend = TRUE, legend="bottom")
```
]

---
# Top ranking cities across years

TODO plot example: https://www.google.com/url?sa=i&url=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F10234952%2Fhow-to-use-ggplot-to-group-and-show-top-x-categories&psig=AOvVaw0XZWd0BGshIPlmbKluyRRl&ust=1638905308005000&source=images&cd=vfe&ved=0CAsQjRxqEAoMCBAVAAAAAB0AAAAAEBA 
Pick 2015 vs. 2020 for years and top10 most populated cities on Y axis? 

---
## Exploring equity in 2021
TODO: finish

```{r}
df.2021 <- read.csv('parks_2021.csv')
#colnames(df.2021)
#original.colnames
```


---
## Conclusions
TODO
- 1
- 2
- 3

